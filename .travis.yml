language: cpp

dist: trusty

os:
    - linux

sudo: required
compiler:
    - gcc

git:
    submodules: false

cache:
    directories:
        - $TRAVIS_BUILD_DIR/zmq

notifications:
    email: false #for now

addons:
    apt:
        sources:
            - ubuntu-toolchain-r-test
        packages:
            - gcc-6
            - g++-6 # Apparently this is not installed with gcc-6
            - pkg-config
            - build-essential
            - cmake # probably already installed


before_install:
    - sed -i 's/git@github.com:/git:\/\/github.com\//' .gitmodules
    - export CXX=g++-6
    - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib

install:
    - mkdir zmq || true
    - cd zmq
    - git clone https://github.com/zeromq/libzmq.git || true
    - git clone https://github.com/zeromq/cppzmq.git || true
    - cd libzmq
    - mkdir build || true
    - cd build
    - cmake .. && make VERBOSE=1
    - sudo make install
    - cd ../../cppzmq
    - mkdir build || true
    - cd build
    - cmake .. && make VERBOSE=1
    - sudo make install
    - cd $TRAVIS_BUILD_DIR
    - sudo ldconfig

script:
    - mkdir build && cd build
    - cmake ..
    - make VERBOSE=1
    - make check
